# Map generator service

Generate image in png format for the given sets of features [GeoJSON](http://geojson.org/).

## Demo

GeoJSON: [Click to view](http://geojson.io/#id=gist:anonymous/bbd413e1dd96f85ef427cb4898cc6d5b&map=15/50.2852/18.9821)

Result: 

![Generated image](https://raw.githubusercontent.com/jakub-gawlas/map-generator-service/master/generated-image.png)

[Run server](#run-server) and go to [http://127.0.0.1:3000/image?data={%20%22t...](http://127.0.0.1:3000/image?data={%20%22type%22:%20%22FeatureCollection%22,%20%22features%22:%20[%20{%20%22type%22:%20%22Feature%22,%20%22properties%22:%20{},%20%22geometry%22:%20{%20%22type%22:%20%22Polygon%22,%20%22coordinates%22:%20[%20[%20[%2018.99162769317627,%2050.285788349437304%20],%20[%2018.99057626724243,%2050.28510281625048%20],%20[%2018.99083375930786,%2050.28495199762422%20],%20[%2018.991241455078125,%2050.28519879149108%20],%20[%2018.991434574127197,%2050.2850205516045%20],%20[%2018.991241455078125,%2050.28488344354519%20],%20[%2018.991520404815674,%2050.284746335090894%20],%20[%2018.992314338684082,%2050.28526734511587%20],%20[%2018.991992473602295,%2050.28540445206923%20],%20[%2018.991713523864746,%2050.28518508075428%20],%20[%2018.991520404815674,%2050.28528105582898%20],%20[%2018.99184226989746,%2050.28565124358988%20],%20[%2018.99162769317627,%2050.285788349437304%20]%20]%20]%20}%20},%20{%20%22type%22:%20%22Feature%22,%20%22properties%22:%20{},%20%22geometry%22:%20{%20%22type%22:%20%22Polygon%22,%20%22coordinates%22:%20[%20[%20[%2018.992443084716797,%2050.28517137001351%20],%20[%2018.991563320159912,%2050.284568093509804%20],%20[%2018.992035388946533,%2050.28437614029134%20],%20[%2018.992228507995605,%2050.284499538877796%20],%20[%2018.991971015930176,%2050.28462293714431%20],%20[%2018.992249965667725,%2050.28477375681334%20],%20[%2018.99259328842163,%2050.28459551533497%20],%20[%2018.9927864074707,%2050.28471891335262%20],%20[%2018.992464542388916,%2050.284910865188635%20],%20[%2018.99265766143799,%2050.28499313002423%20],%20[%2018.992958068847656,%2050.284842311050376%20],%20[%2018.99310827255249,%2050.28506168394527%20],%20[%2018.992443084716797,%2050.28517137001351%20]%20]%20]%20}%20},%20{%20%22type%22:%20%22Feature%22,%20%22properties%22:%20{},%20%22geometry%22:%20{%20%22type%22:%20%22Polygon%22,%20%22coordinates%22:%20[%20[%20[%2018.99338722229004,%2050.284801178520006%20],%20[%2018.992271423339844,%2050.28418418629873%20],%20[%2018.992936611175537,%2050.283855120510225%20],%20[%2018.99308681488037,%2050.2840333647614%20],%20[%2018.992743492126465,%2050.28418418629873%20],%20[%2018.99364471435547,%2050.28467778071562%20],%20[%2018.99338722229004,%2050.284801178520006%20]%20]%20]%20}%20},%20{%20%22type%22:%20%22Feature%22,%20%22properties%22:%20{},%20%22geometry%22:%20{%20%22type%22:%20%22Polygon%22,%20%22coordinates%22:%20[%20[%20[%2018.993966579437256,%2050.284499538877796%20],%20[%2018.993194103240967,%2050.283772853707625%20],%20[%2018.993666172027588,%2050.28353976366136%20],%20[%2018.993794918060303,%2050.28366316441626%20],%20[%2018.99358034133911,%2050.283827698258484%20],%20[%2018.994224071502686,%2050.284362429317554%20],%20[%2018.993966579437256,%2050.284499538877796%20]%20]%20]%20}%20},%20{%20%22type%22:%20%22Feature%22,%20%22properties%22:%20{},%20%22geometry%22:%20{%20%22type%22:%20%22Polygon%22,%20%22coordinates%22:%20[%20[%20[%2018.994674682617184,%2050.28415676423658%20],%20[%2018.99388074874878,%2050.28347120754815%20],%20[%2018.994674682617184,%2050.283114714167674%20],%20[%2018.99540424346924,%2050.283813987126685%20],%20[%2018.99488925933838,%2050.2840333647614%20],%20[%2018.994739055633545,%2050.283855120510225%20],%20[%2018.995060920715332,%2050.28371800909356%20],%20[%2018.994567394256592,%2050.283416362586465%20],%20[%2018.994288444519043,%2050.28353976366136%20],%20[%2018.994870483875275,%2050.28404878971331%20],%20[%2018.994674682617184,%2050.28415676423658%20]%20]%20]%20}%20}%20]%20})

## Installation
```bash
yarn
```

## Usage

### Env variables

| name | description | required | default |
|:------:|:-------------:|:----------:|:---------:|
| APP_SERVER_PORT | Server port | false | 3000 |
| **APP_MAP_SERVICE_MAPBOX_TOKEN** | MapBox token | **true** | - |
| APP_MAP_SERVICE_WEB_PORT | Web application port | false | 8080 |

### Run server

To run server required is installed *Chrome* or *Chromium* supported **headless* mode with *GPU* acceleration.

```bash
export APP_MAP_SERVICE_MAPBOX_TOKEN={{MAPBOX_TOKEN}}
node src
```

### Endpoints
**GET /image**

*query parameters:*
- ***data*** *(JSON)*: GeoJSON of type *FeatureCollection* ***(required)***
- ***width*** *(number)*: width of result image *FeatureCollection* *(optional)*
- ***height*** *(number)*: height of result image *(optional)*

Example `data` GeoJSON:
```geojson
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {},
      "geometry": {
        "type": "Polygon",
        "coordinates": [
          [
            [
              19.003279209136963,
              50.25621233113204
            ],
            [
              19.003483057022095,
              50.25593794866982
            ],
            [
              19.004191160202026,
              50.256164314315235
            ],
            [
              19.00386929512024,
              50.25634266224804
            ],
            [
              19.003279209136963,
              50.25621233113204
            ]
          ]
        ]
      }
    }
  ]
}
```

### Run with Docker

Application uses **Chromium** in *headless mode* to generate maps, and additionaly required is *GPU acceleration*.
**Docker** doesn't support *GPU*, so to run application in container is needed use [nvidia-docker](https://github.com/NVIDIA/nvidia-docker).
